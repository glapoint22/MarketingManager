<div class="container">
    <!-- Editor panel -->
    <div style="width: 408px;height: 100%;background: #151515;float: right;max-width: 1600px;">
        <div resizable class="divider"></div>
        <editor [name]="'Properties'">
            <properties #properties></properties>
        </editor>
    </div>
    <!-- Divider -->
    <div resizable class="divider"></div>

    <div *ngIf="currentItem && currentItem.isSelected">
        <div class="header">

            <!-- Paste email -->
            <div style="float:right" class="header-button" title="Paste email" (click)="pasteEmail()" [ngClass]="{'disabled': !copy || (currentItem.tierIndex === 1 && currentItem.emails.length === 1) }">
                <i class="fas fa-paste"></i>
            </div>

            <!-- Cut email -->
            <div style="float:right" class="header-button" title="Cut email" (click)="cutEmail()" [ngClass]="{'disabled': !currentEmail || !currentEmail.selected}">
                <i class="fas fa-cut"></i>
            </div>


            <!-- Copy email -->
            <div style="float:right" class="header-button" title="Copy email" (click)="copyEmail()" [ngClass]="{'disabled': !currentEmail || !currentEmail.selected}">
                <i class="fas fa-copy"></i>
            </div>


            <!-- Delete email -->
            <div style="float:right" class="header-button" title="Delete email" (click)="deleteEmail()" [ngClass]="{'disabled': !currentEmail || !currentEmail.selected}">
                <i class="fas fa-trash-alt"></i>
            </div>

            <!-- New email -->
            <div style="float:right" class="header-button" title="New email" (click)="newEmail()" [ngClass]="{'disabled': currentItem.tierIndex === 1 && currentItem.emails.length === 1 }">
                <i class="fas fa-envelope"></i>
            </div>





        </div>

        <!-- Email container -->
        <div class="emails-container" [style.height.px]="height">
            <div *ngFor="let email of emails | deletedFilter : change; let i = index" class="row">

                <!-- Toggle button -->
                <span>
                    <input #inputToggle name="email" [id]="email.id" type="radio">
                    <label class="toggle-button" [for]="email.id" (click)="onToggleButtonClick(inputToggle, i, email); $event.preventDefault()"></label>
                </span>

                <!-- Email subject bar -->
                <div class="bar subject highlight" style="margin-left: 23px;" [ngClass]="{'selected': email.selected && !inputToggle.checked, 'expanded': inputToggle.checked}"
                    (click)="onEmailClick(email)">


                    <span *ngIf="email.isInEditMode else subjectValue">
                        <input #edit class="edit" type="text" [value]="email.subject" (focus)="edit.select()" (blur)="email.isInEditMode = false">
                    </span>
                    <ng-template #subjectValue>
                        {{email.subject}}
                    </ng-template>


                    <!-- Button container -->
                    <span *ngIf="inputToggle.checked" class="button-container">

                        <!-- Group -->
                        <span class="button-group">
                            <!-- Preview -->
                            <div class="header-button" title="Preview" (click)="emailPreviewService.open(currentEmail.body)">
                                <i class="far fa-eye"></i>
                            </div>
                        </span>


                        <!-- Group -->
                        <span class="button-group">
                            <!-- Text -->
                            <div class="header-button" (click)="editBoxService.createTextBox()" title="Text">
                                <i class="fas fa-file-alt"></i>
                            </div>

                            <!-- Button -->
                            <div class="header-button" (click)="editBoxService.createButtonBox()" title="Button">
                                <i class="fas fa-dot-circle"></i>
                            </div>


                            <!-- Image -->
                            <div class="header-button" (click)="editBoxService.createImageBox()" title="Image">
                                <i class="fas fa-image"></i>
                            </div>

                            <!-- Container -->
                            <div class="header-button" (click)="editBoxService.createContainerBox()" title="Container">
                                <i class="fas fa-square"></i>
                            </div>
                        </span>

                        <!-- Group -->
                        <span class="button-group">
                            <!-- Background color -->
                            <div class="header-button" (click)="setColor('background')" title="Background color">
                                <i class="fas fa-fill"></i>
                                <div class="palette" [style.background]="email.backgroundColor"></div>
                            </div>


                            <!-- Page color -->
                            <div class="header-button" (click)="setColor('page')" title="Page color">
                                <i class="fas fa-palette"></i>
                                <div class="palette" [style.background]="email.pageColor"></div>
                            </div>
                        </span>
                    </span>

                    <!-- Edit -->
                    <div class="header-button edit-button" title="Edit subject" (click)="editEmail(email)">
                        <i class="fas fa-edit"></i>
                    </div>
                </div>

                <!-- Email content -->
                <div style="background-color: #1e1e1e">
                    <div class="email-content-container" [style.transition]="'max-height ' + speed + 's'"
                        (transitionend)="transitionEnd($event)" [style.backgroundColor]="email.backgroundColor"
                        [style.maxHeight.px]="inputToggle.checked && editBoxManagerService.mainContainer ? editBoxManagerService.mainContainer.height : 0"
                        (mousedown)="onMouseDown()">

                        <!-- Email page -->
                        <div class="page" [style.width.px]="pageWidth" [style.height.px]="editBoxManagerService.mainContainer ?  editBoxManagerService.mainContainer.height : 0"
                            [style.opacity]="editBoxManagerService.mainContainer && editBoxManagerService.mainContainer.height === 0 ? 0 : 1"
                            [style.backgroundColor]="email.pageColor">
                            <ng-template #viewContainerRef>
                                <!-- EditBoxes go here -->
                            </ng-template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

<!-- Email grid -->
<div style="width: auto; height: 100%; background: #1e1e1e; overflow-x: hidden;">
    <email-grid (onItemClick)="onItemClick($event); properties.gridItem = $event"></email-grid>
</div>